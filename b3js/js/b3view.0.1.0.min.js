/*! Behavior3JS 2014-10-26 */
this.b3view=this.b3view||{},function(){"use strict";var a=function(a){this.initialize(a)},b=a.prototype=new createjs.EventDispatcher;b.initialize=function(a){this.settings=new b3view.SettingsManager,this.settings.load(b3view.OPTIONS),this.settings.load(b3view.THEME_DEFAULT),this.settings.load(b3view.THEME_DARK),this.ui=new b3view.UI(this,a),this.organizer=new b3view.Organizer(this),this.blocks=[],this.connections=[],this.nodes={},this.symbols={},this.shapes={},this.registerShape("root",b3view.draw.rootShape),this.registerShape("composite",b3view.draw.compositeShape),this.registerShape("decorator",b3view.draw.decoratorShape),this.registerShape("condition",b3view.draw.conditionShape),this.registerShape("action",b3view.draw.actionShape),this.registerSymbol("Root",b3view.draw.rootSymbol),this.registerSymbol("Sequence",b3view.draw.sequenceSymbol),this.registerSymbol("MemSequence",b3view.draw.memsequenceSymbol),this.registerSymbol("Priority",b3view.draw.prioritySymbol),this.registerSymbol("MemPriority",b3view.draw.memprioritySymbol),this.registerNode(b3view.Root),this.registerNode(b3.Sequence),this.registerNode(b3.Priority),this.registerNode(b3.MemSequence),this.registerNode(b3.MemPriority),this.registerNode(b3.Repeater),this.registerNode(b3.RepeatUntilFailure),this.registerNode(b3.RepeatUntilSuccess),this.registerNode(b3.MaxTime),this.registerNode(b3.Inverter),this.registerNode(b3.Limiter),this.registerNode(b3.Failer),this.registerNode(b3.Succeeder),this.registerNode(b3.Runner),this.registerNode(b3.Error),this.registerNode(b3.Wait),this.reset(),this.center(),this.update()},b.center=function(){var a=this.ui.canvas.width/2,b=this.ui.canvas.height/2;this.setcam(a,b)},b.fullscale=function(){this.ui.display.scaleMode=creatine.STRETCH,this.ui.display.refresh(),this.center()},b.registerNode=function(a){var b=a.prototype.name;this.nodes[b]=a},b.registerSymbol=function(a,b){b||(b=a),this.symbols[a]=b},b.registerShape=function(a,b){this.shapes[a]=b},b.getLocalMousePosition=function(){return this.ui.camera.globalToLocal(this.ui.stage.mouseX,this.ui.stage.mouseY)},b.getRoot=function(){for(var a=0;a<this.blocks.length;a++)if("root"==this.blocks[a].category)return this.blocks[a]},b.getBlockUnder=function(a,b){if(!a||!b){var c=this.getLocalMousePosition();a=c.x,b=c.y}for(var d=this.blocks.length-1;d>=0;d--){var e=this.blocks[d];if(e.hitTest(a,b))return e}},b.getBlockById=function(a){for(var b=0;b<this.blocks.length;b++){var c=this.blocks[b];if(c.id==a)return c}},b.applySettings=function(){var a=this.settings;this.ui.applySettings(a);for(var b=0;b<this.blocks.length;b++)this.blocks[b].applySettings(a);for(var b=0;b<this.connections.length;b++)this.connections[b].applySettings(a)},b.update=function(){this.ui.stage.update()},b.reset=function(a){for(var b=0;b<this.blocks.length;b++){var c=this.blocks[b];this.ui.layerBlocks.removeChild(c.displayObject)}this.blocks=[];for(var b=0;b<this.connections.length;b++){var d=this.connections[b];this.ui.layerConnections.removeChild(d.displayObject)}this.connections=[],this.ui.camera.x=0,this.ui.camera.y=0,this.ui.camera.scaleX=1,this.ui.camera.scaleY=1,a||this.addBlock("Root",0,0)},b.importFromJSON=function(a){this.reset();var b=JSON.parse(a),c=null;for(var d in b.nodes){var e=b.nodes[d],f=this.addBlock(e.name,e.display.x,e.display.y);f.id=e.id,f.title=e.title,f.description=e.description,f.parameters=e.parameters,f.properties=e.properties,f.redraw(),f.id===b.root&&(c=f)}for(var d in b.nodes){var e=b.nodes[d],g=this.getBlockById(d),h=null;if("composite"==g.category&&e.children?h=e.children:("decorator"==g.category&&e.child||"root"==g.category&&e.child)&&(h=[e.child]),h)for(var i=0;i<h.length;i++){var j=this.getBlockById(h[i]);this.addConnection(g,j)}}c&&this.addConnection(this.getRoot(),c),this.ui.camera.x=b.display.camera_x,this.ui.camera.y=b.display.camera_y,this.ui.camera.scaleX=b.display.camera_z,this.ui.camera.scaleY=b.display.camera_z},b.exportToJSON=function(){var a=this.getRoot(),b={};b.title=a.title,b.description=a.description,b.root=a.getOutNodeIds()[0]||null,b.display={camera_x:this.ui.camera.x,camera_y:this.ui.camera.y,camera_z:this.ui.camera.scaleX,x:a.displayObject.x,y:a.displayObject.y},b.properties=a.properties,b.nodes={};for(var c=0;c<this.blocks.length;c++){var d=this.blocks[c];if("root"!==d.category){var e={};e.id=d.id,e.name=d.name,e.title=d.title,e.description=d.description,e.display={x:d.displayObject.x,y:d.displayObject.y},e.parameters=d.parameters,e.properties=d.properties;var f=d.getOutNodeIds();"composite"==d.category?e.children=f:("decorator"==d.category||"root"==d.category)&&(e.child=f[0]||null),b.nodes[d.id]=e}}return JSON.stringify(b,null,4)},b.importFromTree=function(a){this.reset();var b=this.getRoot();b.id=a.id,b.title=a.title,b.description=a.description,b.properties=a.properties;for(var c=[a.root],d={};c.length>0;){var e=c.pop(),f=new b3view.Block(this,e);if(this.blocks.push(f),this.ui.layerBlocks.addChild(f.displayObject),f.id=e.id,d[f.id]=f,e.category===b3.COMPOSITE&&e.children)for(var g=e.children.length-1;g>=0;g--)c.push(e.children[g]);else e.category===b3.DECORATOR&&e.child&&c.push(e.child)}for(var c=[a.root];c.length>0;){var e=c.pop(),h=d[e.id];if(e.category===b3.COMPOSITE&&e.children)for(var g=0;g<e.children.length;g++){var i=e.children[g],j=d[i.id];this.addConnection(h,j),c.push(i)}else if(e.category===b3.DECORATOR&&e.child){var j=d[e.child.id];this.addConnection(h,j),c.push(e.child)}}this.addConnection(b,d[a.root.id]),this.organize(!0)},b.addBlock=function(a,b,c){if(b=b||0,c=c||0,"string"==typeof a)var d=this.nodes[a];else var d=a;var e=new b3view.Block(this,d);return e.displayObject.x=b,e.displayObject.y=c,this.blocks.push(e),this.ui.layerBlocks.addChild(e.displayObject),e},b.addConnection=function(a,b){var c=new b3view.Connection(this);return a&&(c.addInBlock(a),a.addOutConnection(c)),b&&(c.addOutBlock(b),b.addInConnection(c)),this.connections.push(c),this.ui.layerConnections.addChild(c.displayObject),c.redraw(),c},b.removeBlock=function(a){var b=this.blocks.indexOf(a);if(b>-1&&this.blocks.splice(b,1),a.inConnection&&this.removeConnection(a.inConnection),a.outConnections.length>0)for(var c=a.outConnections.length-1;c>=0;c--)this.removeConnection(a.outConnections[c]);this.ui.layerBlocks.removeChild(a.displayObject)},b.removeConnection=function(a){a.inBlock&&(a.inBlock.removeOutConnection(a),a.removeInBlock()),a.outBlock&&(a.outBlock.removeInConnection(),a.removeOutBlock());var b=this.connections.indexOf(a);b>-1&&this.connections.splice(b,1),this.ui.layerConnections.removeChild(a.displayObject)},b.zoom=function(a){this.ui.camera.scaleX=a,this.ui.camera.scaleY=a},b.pan=function(a,b){this.ui.camera.x+=a,this.ui.camera.y+=b},b.setcam=function(a,b){this.ui.camera.x=a,this.ui.camera.y=b},b.organize=function(a){this.organizer.organize(this.getRoot(),a)},b3view.View=a}(),this.b3view=this.b3view||{},function(){"use strict";var a={connection_width:2,anchor_border_width:2,anchor_radius:7,anchor_offset_x:4,anchor_offset_y:0,block_border_width:2,block_root_width:40,block_root_height:40,block_composite_width:40,block_composite_height:40,block_decorator_width:60,block_decorator_height:60,block_action_width:160,block_action_height:40,block_condition_width:160,block_condition_height:40};b3view.OPTIONS=a}(),this.b3view=this.b3view||{},function(){"use strict";var a={symbol_template:"libs/symbols/{category}.svg",background_color:"#171717",selection_color:"#4bb2fd",block_background_color:"#EFEFEF",block_border_color:"#6d6d6d",block_symbol_color:"#333",anchor_background_color:"#EFEFEF",anchor_border_color:"#6d6d6d",connection_color:"#6d6d6d"};b3view.THEME_DEFAULT=a}(),this.b3view=this.b3view||{},function(){"use strict";var a={};b3view.THEME_DARK=a}(),this.b3view=this.b3view||{},function(){"use strict";var a={};b3view.THEME_LIGHT=a}(),this.b3view=this.b3view||{},this.b3view.draw=this.b3view.draw||{},function(){"use strict";var a=function(a,b,c,d,e,f,g){a.graphics.beginFill(e),a.graphics.setStrokeStyle(f,"round"),a.graphics.beginStroke(g),a.graphics.drawCircle(b,c,d),a.graphics.endStroke(),a.graphics.endFill()},b=function(a,b,c,d,e,f,g){a.graphics.beginFill(e),a.graphics.setStrokeStyle(f,"round"),a.graphics.beginStroke(g),a.graphics.drawRoundRect(-b/2,-c/2,b,c,d),a.graphics.endStroke(),a.graphics.endFill()},c=function(a,b,c,d,e,f){a.graphics.beginFill(d),a.graphics.setStrokeStyle(e,"round"),a.graphics.beginStroke(f),a.graphics.drawEllipse(-b/2,-c/2,b,c),a.graphics.endStroke(),a.graphics.endFill()},d=function(a,b,c,d,e,f){a.graphics.beginFill(d),a.graphics.setStrokeStyle(e,"round"),a.graphics.beginStroke(f),a.graphics.moveTo(0,c/2),a.graphics.lineTo(b/2,0),a.graphics.lineTo(0,-c/2),a.graphics.lineTo(-b/2,0),a.graphics.lineTo(0,c/2),a.graphics.endStroke(),a.graphics.endFill()};b3view.draw.rootShape=function(c,d){var e=c._width,f=c._height,g=d.get("anchor_offset_x"),h=c._shapeObject;a(h,e/2+g,0,d.get("anchor_radius"),d.get("anchor_background_color"),d.get("anchor_border_width"),d.get("anchor_border_color")),b(h,e,f,15,d.get("block_background_color"),d.get("block_border_width"),d.get("block_border_color"))},b3view.draw.compositeShape=function(c,d){var e=c._symbolObject.getBounds(),f=0;e&&(f=e.width+20);var g=Math.max(f,c._width),h=c._height,i=d.get("anchor_offset_x"),j=c._shapeObject;c._width=g,c._height=h,a(j,-g/2-i,0,d.get("anchor_radius"),d.get("anchor_background_color"),d.get("anchor_border_width"),d.get("anchor_border_color")),a(j,g/2+i,0,d.get("anchor_radius"),d.get("anchor_background_color"),d.get("anchor_border_width"),d.get("anchor_border_color")),b(j,g,h,15,d.get("block_background_color"),d.get("block_border_width"),d.get("block_border_color"))},b3view.draw.decoratorShape=function(b,c){var e=b._symbolObject.getBounds(),f=Math.max(e.width+40,b._width),g=Math.max(e.height+50,b._height),h=c.get("anchor_offset_x"),i=b._shapeObject;b._width=f,b._height=g,a(i,-f/2-h,0,c.get("anchor_radius"),c.get("anchor_background_color"),c.get("anchor_border_width"),c.get("anchor_border_color")),a(i,f/2+h,0,c.get("anchor_radius"),c.get("anchor_background_color"),c.get("anchor_border_width"),c.get("anchor_border_color")),d(i,f,g,15,c.get("block_background_color"),c.get("block_border_width"),c.get("block_border_color"))},b3view.draw.actionShape=function(c,d){var e=c._symbolObject.getBounds(),f=Math.max(e.width+15,c._width),g=Math.max(e.height+15,c._height),h=d.get("anchor_offset_x"),i=c._shapeObject;c._width=f,c._height=g,a(i,-f/2-h,0,d.get("anchor_radius"),d.get("anchor_background_color"),d.get("anchor_border_width"),d.get("anchor_border_color")),b(i,f,g,15,d.get("block_background_color"),d.get("block_border_width"),d.get("block_border_color"))},b3view.draw.conditionShape=function(b,d){var e=b._symbolObject.getBounds(),f=Math.max(e.width+15,b._width),g=Math.max(e.height+15,b._height),h=d.get("anchor_offset_x"),i=b._shapeObject;b._width=f,b._height=g,a(i,-f/2-h,0,d.get("anchor_radius"),d.get("anchor_background_color"),d.get("anchor_border_width"),d.get("anchor_border_color")),c(i,f,g,d.get("block_background_color"),d.get("block_border_width"),d.get("block_border_color"))}}(),this.b3view=this.b3view||{},this.b3view.draw=this.b3view.draw||{},function(){"use strict";b3view.draw.rootSymbol=function(a,b){var c=new createjs.Shape,d=(a._width,a._height),e=d/20,f=d/5,g=b.get("block_symbol_color");return c.graphics.setStrokeStyle(e,"round"),c.graphics.beginStroke(g),c.graphics.drawCircle(0,0,f),c.graphics.moveTo(-f,f),c.graphics.lineTo(f,-f),c.graphics.endStroke(),c},b3view.draw.sequenceSymbol=function(a,b){var c=new createjs.Shape,d=(a._width,a._height),e=d/20,f=d/4,g=b.get("block_symbol_color");return c.graphics.setStrokeStyle(e,"round"),c.graphics.beginStroke(g),c.graphics.beginFill(g),c.graphics.moveTo(-f,0),c.graphics.lineTo(f,0),c.graphics.drawPolyStar(f/2,0,f/2,3,0,0),c.graphics.endFill(),c.graphics.endStroke(),c},b3view.draw.memsequenceSymbol=function(a,b){var c=new createjs.Shape,d=(a._width,a._height),e=d/20,f=d/4,g=b.get("block_symbol_color");return c.graphics.setStrokeStyle(e,"round"),c.graphics.beginStroke(g),c.graphics.beginFill(g),c.graphics.drawPolyStar(0,.75*-f,f/2,6,f/10,0),c.graphics.setStrokeStyle(e,"round"),c.graphics.beginStroke(g),c.graphics.beginFill(g),c.graphics.moveTo(-f,f/2),c.graphics.lineTo(f,f/2),c.graphics.drawPolyStar(f/2,f/2,f/2,3,0,0),c.graphics.endFill(),c.graphics.endStroke(),c},b3view.draw.prioritySymbol=function(a,b){var c=new createjs.Shape,d=(a._width,a._height),e=d/20,f=d/8,g=b.get("block_symbol_color");return c.graphics.setStrokeStyle(e,"round"),c.graphics.beginStroke(g),c.graphics.arc(0,-f,f,3.141561,1.570796,!1),c.graphics.lineTo(0,f),c.graphics.beginFill(g),c.graphics.drawCircle(0,2*f,e/2),c.graphics.endFill(),c.graphics.endStroke(),c},b3view.draw.memprioritySymbol=function(a,b){var c=new createjs.Shape,d=(a._width,a._height),e=d/20,f=d/8,g=b.get("block_symbol_color");return c.graphics.setStrokeStyle(e,"round"),c.graphics.beginStroke(g),c.graphics.arc(-f,-f,f,3.141561,1.570796,!1),c.graphics.lineTo(-f,f),c.graphics.beginFill(g),c.graphics.drawCircle(-f,2*f,e/2),c.graphics.drawPolyStar(1.5*f,0,f/2,6,f/10,0),c.graphics.endFill(),c.graphics.endStroke(),c},b3view.draw.textSymbol=function(a){var b=new createjs.Text(a.title||a.name,"18px Arial","#333333");b.textAlign="center";var c=b.getBounds();return b.regY=c.height/2,b}}(),this.b3view=this.b3view||{},function(){"use strict";var a=function(a,b){this.initialize(a,b)},b=a.prototype;b.initialize=function(a,b){var c=b.prototype;c||(c=b),this.id=b3.createUUID(),this.node=b,this.name=c.name,this.category=c.category,this.title=c.title||this.name,this.description=c.description||"",this.parameters=c.parameters||{},this.properties=c.properties||{},this.view=a,this.settings=a.settings,this.displayObject=new createjs.Container,this.inConnection=null,this.outConnections=[],this.isSelected=!1,this.isDragging=!1,this.dragOffsetX=0,this.dragOffsetX=0,this._width=null,this._height=null,this._shapeObject=new createjs.Shape,this._shadowObject=null,this._symbolObject=null,this.applySettings()},b.applySettings=function(a){this.settings=a||this.settings,this._shadowObject=new createjs.Shadow(this.settings.get("selection_color"),0,0,5),this.redraw()},b.copy=function(){var a=new b3view.Block(this.view,this.node);return a.displayObject.x=this.displayObject.x,a.displayObject.y=this.displayObject.y,a._width=this._width,a._height=this._height,a.anchorXOffset=this.anchorXOffset,a.category=this.category,a.title=this.title,a.description=this.description,a},b.redraw=function(){var a=this.settings,b=this.name,c=this.category.toLowerCase(),d=this.view.shapes[c],e=this.view.symbols[b]||b3view.draw.textSymbol;this._width=a.get("block_"+c+"_width"),this._height=a.get("block_"+c+"_height"),this.displayObject.removeAllChildren(),this._symbolObject=e(this,a),this._shapeObject.graphics.clear(),d(this,a),this.displayObject.addChild(this._shapeObject),this.displayObject.addChild(this._symbolObject)},b.select=function(){this.isSelected=!0,this._shapeObject.shadow=this._shadowObject},b.deselect=function(){this.isSelected=!1,this._shapeObject.shadow=null},b.getOutNodeIds=function(){for(var a=[],b=0;b<this.outConnections.length;b++)a.push(this.outConnections[b].outBlock.id);return a},b.getOutConnectionsByOrder=function(){var a=this.outConnections.slice(0);return a.sort(function(a,b){return a.outBlock.displayObject.y-b.outBlock.displayObject.y}),a},b.addInConnection=function(a){this.inConnection=a},b.addOutConnection=function(a){this.outConnections.push(a)},b.removeInConnection=function(){this.inConnection=null},b.removeOutConnection=function(a){var b=this.outConnections.indexOf(a);b>-1&&this.outConnections.splice(b,1)},b.hitTest=function(a,b){return a-=this.displayObject.x,b-=this.displayObject.y,this._shapeObject.hitTest(a,b)},b.isContainedIn=function(a,b,c,d){return a<this.displayObject.x-this._width/2&&b<this.displayObject.y-this._height/2&&c>this.displayObject.x+this._width/2&&d>this.displayObject.y+this._height/2?!0:!1},b.getLeftAnchorX=function(){return this.displayObject.x-this._width/2-this.settings.get("anchor_offset_x")},b.getRightAnchorX=function(){return this.displayObject.x+this._width/2+this.settings.get("anchor_offset_x")},b.mouseInBlock=function(a){return Math.abs(a-this.displayObject.x)<this._width/2},b.mouseInLeftAnchor=function(a){var b=a-this.displayObject.x;return Math.abs(b)>this._width/2&&0>b},b.mouseInRightAnchor=function(a){var b=a-this.displayObject.x;return Math.abs(b)>this._width/2&&b>0},b3view.Block=a}(),this.b3view=this.b3view||{},function(){"use strict";var a=function(a){this.initialize(a)},b=a.prototype;b.initialize=function(a){this.view=a,this.inBlock=null,this.outBlock=null,this.displayObject=new createjs.Shape,this.settings=null,this.applySettings(this.view.settings)},b.addInBlock=function(a){this.inBlock=a},b.addOutBlock=function(a){this.outBlock=a},b.removeInBlock=function(){this.inBlock=null},b.removeOutBlock=function(){this.outBlock=null},b.applySettings=function(a){this.settings=a,this.redraw()},b.redraw=function(a,b,c,d){if((this.inBlock||null!=a||null!=b)&&(this.outBlock||null!=c||null!=d)){var e=this.settings,f=this.displayObject.graphics,g=e.get("connection_width"),h=e.get("connection_color"),i=e.get("anchor_radius")+e.get("anchor_border_width"),j=e.get("anchor_radius")/2;a=0==a||a?a:this.inBlock.getRightAnchorX(),c=0==c||c?c:this.outBlock.getLeftAnchorX()-i,b=0==b||b?b:this.inBlock.displayObject.y,d=0==d||d?d:this.outBlock.displayObject.y;var k=2.5*(c-a)/4;f.clear(),f.setStrokeStyle(g,"round"),f.beginStroke(h),f.moveTo(a,b),f.bezierCurveTo(a+k,b,c-k,d,c,d),f.beginFill(h),f.drawPolyStar(c-j,d,j,3,0,0),f.endFill(),f.endStroke()}},b3view.Connection=a}(),this.b3view=this.b3view||{},function(){"use strict";var a=function(a){this.initialize(a)},b=a.prototype;b.initialize=function(a){this.view=a,this.depth=0,this.leafCont=0,this.horizontalSpacing=208,this.verticalSpacing=64,this.orderByIndex=!1,this.connections=[],this.blocks=[]},b.__step=function(a){if(this.blocks.push(a),0==a.outConnections.length){this.leafCont++;var b=this.depth*this.horizontalSpacing,c=this.leafCont*this.verticalSpacing}else{var d=0;if(this.orderByIndex)var e=a.outConnections;else var e=a.getOutConnectionsByOrder();for(var f=0;f<e.length;f++)this.depth++,this.connections.push(e[f]),d+=this.__step(e[f].outBlock),this.depth--;var b=this.depth*this.horizontalSpacing,c=d/a.outConnections.length}return a.displayObject.x=b,a.displayObject.y=c,c},b.organize=function(a,b){if(a){this.depth=0,this.leafCont=0,this.connections=[],this.blocks=[],this.orderByIndex=b;var c=a.displayObject.x,d=a.displayObject.y,a=a;this.__step(a),c-=a.displayObject.x,d-=a.displayObject.y;for(var e=0;e<this.blocks.length;e++)this.blocks[e].displayObject.x+=c,this.blocks[e].displayObject.y+=d;for(var e=0;e<this.connections.length;e++)this.connections[e].redraw()}},b3view.Organizer=a}(),this.b3view=this.b3view||{},function(){"use strict";var a=b3.Class(),b=a.prototype;b.name="Root",b.category="root",b.title="A Behavior Tree",b3view.Root=a}(),this.b3view=this.b3view||{},function(){"use strict";var a=function(){this.initialize()},b=a.prototype;b.initialize=function(){this._dict={}},b.clear=function(){this._dict={}},b.set=function(a,b){this._dict[a]=b},b.get=function(a){return this._dict[a]},b.load=function(a){for(var b in a)this.set(b,a[b])},b3view.SettingsManager=a}(),this.b3view=this.b3view||{},function(){"use strict";var a=function(a,b){this.initialize(a,b)},b=a.prototype;b.initialize=function(a,b){this.view=a,this.canvas=b,this.stage=new createjs.Stage(b),this.display=new creatine.Display(b),this.display.setUserSelect(!1),this.display.setTouchAction(!1),this.stage.snapToPixelEnabled=!0,createjs.Ticker.setFPS(60),this.camera=new createjs.Container,this.layerConnections=new createjs.Container,this.layerBlocks=new createjs.Container,this.layerOverlay=new createjs.Container,this.applySettings(this.view.settings),this.camera.addChild(this.layerConnections),this.camera.addChild(this.layerBlocks),this.camera.addChild(this.layerOverlay),this.stage.addChild(this.camera)},b.applySettings=function(a){this.canvas.style.background=a.get("background_color")},b3view.UI=a}();